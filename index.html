<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manajemen Cuti RRI Sibolga</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
    /* CSS sesuai sebelumnya, tambahkan untuk form dan kartu */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f0f4f8;
      color: #333;
      line-height: 1.6;
    }

    /* Gaya tombol dan layout lainnya */
    #action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 15px 20px;
      background-color: #e0e0e0;
    }

    .btn {
      padding: 12px 20px;
      background-color: #007bff;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: background-color 0.2s, transform 0.2s;
    }

    .btn:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }

    #header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      background-color: #007bff;
      padding: 15px 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    #logo-title {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    #logo {
      width: 60px;
    }

    #title {
      font-size: 22px;
      font-weight: 700;
      color: #fff;
    }

    #waktu {
      text-align: right;
      margin-top: 10px;
      font-size: 16px;
      color: #fff;
    }

    h2 {
      margin: 20px 10px 10px 10px;
      font-size: 20px;
      color: #007bff;
    }

    #listPegawai {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin: 20px;
    }

    .pegawaiCard {
      background-color: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      width: 300px; /* lebih luas agar muat form */
    }

    .pegawaiCard:hover {
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .pegawaiName {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #222;
    }

    /* Style form input cuti */
    .form-group {
      margin-bottom: 8px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      font-size: 14px;
    }

    .form-group input {
      width: 80px;
      padding: 4px;
      margin-top: 4px;
    }

    /* Tombol simpan */
    .btn-simpan {
      background-color: #28a745;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-simpan:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <!-- Tombol login dan mode -->
  <div style="text-align:center; margin:10px;">
    <button id="loginAdminBtn" class="btn" style="background-color:#dc3545;">Login Admin</button>
    <button id="toggleModeBtn" class="btn" style="background-color:#28a745;">Mode: User</button>
  </div>

  <!-- Container utama -->
  <h2 style="text-align:center;">Daftar Pegawai</h2>
  <div id="listPegawai"></div>

  <script>
    // ================== Firebase Config ==================
    const firebaseConfig = {
      apiKey: "AIzaSyBBDMhvpAboYaEUIfo0eyzjZxK6iZyQwpo",
      authDomain: "cutirri.firebaseapp.com",
      projectId: "cutirri",
      storageBucket: "cutirri.firebasestorage.app",
      messagingSenderId: "310950239670",
      appId: "1:310950239670:web:3b58351db2c5946f8c3517",
      measurementId: "G-BENDLYTZ2Z"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let isAdmin = false;
    const PASSWORD_ADMIN = "rriadmin2025";

    // Fungsi waktu
    function updateTime() {
      const now = new Date();
      document.getElementById('tanggal')?.remove(); // hapus jika ada
      document.getElementById('jam')?.remove();
      // tidak perlu di sini, fokus ke fitur utama
    }

    // ================== Login Admin ==================
    document.getElementById('loginAdminBtn').addEventListener('click', () => {
      const password = prompt('Masukkan password admin:');
      if (password === PASSWORD_ADMIN) {
        isAdmin = true;
        document.getElementById('toggleModeBtn').textContent = 'Mode: Admin';
        loadPegawai();
        alert('Anda masuk sebagai Admin.');
        document.getElementById('loginAdminBtn').style.display = 'none';
      } else {
        alert('Password salah!');
      }
    });

    // ================== Mode toggle ==================
    document.getElementById('toggleModeBtn').addEventListener('click', () => {
      if (!isAdmin) {
        alert('Silakan login sebagai admin terlebih dahulu.');
        return;
      }
      isAdmin = false;
      document.getElementById('toggleModeBtn').textContent = 'Mode: User';
      loadPegawai();
      document.getElementById('loginAdminBtn').style.display = 'inline-block';
    });

    // ================== Data pegawai dari Firebase ==================
    function loadPegawai() {
      // Bersihkan
      const container = document.getElementById('listPegawai');
      container.innerHTML = '';

      db.collection('pegawai').get()
        .then(querySnapshot => {
          querySnapshot.forEach(doc => {
            const data = doc.data();
            const nama = data.nama || 'Tanpa Nama';
            const nik = data.nik || 'NIK tidak diketahui';
            const cuti = data.cutiTerpakai || {}; // object semua cuti

            // Buat kartu
            const card = document.createElement('div');
            card.className = 'pegawaiCard';

            // Nama dan nik
            const namaEl = document.createElement('div');
            namaEl.className = 'pegawaiName';
            namaEl.textContent = `${nama} (NIK: ${nik})`;
            card.appendChild(namaEl);

            // Form input semua jenis cuti
            const fields = [
              { label: 'Cuti Tahunan', key: 'tahunan' },
              { label: 'Cuti Besar', key: 'besar' },
              { label: 'Cuti Sakit', key: 'sakit' },
              { label: 'Cuti Melahirkan', key: 'melahirkan' },
              { label: 'Cuti Karena Alasan Penting', key: 'penting' },
              { label: 'Cuti di Luar Negara', key: 'luar_negara' }
            ];

            fields.forEach(f => {
              const div = document.createElement('div');
              div.className = 'form-group';

              const label = document.createElement('label');
              label.textContent = f.label + ': ';
              div.appendChild(label);

              const input = document.createElement('input');
              input.type = 'number';
              input.value = cuti[f.key] !== undefined ? cuti[f.key] : 0;
              input.dataset.nik = doc.id; // simpan id pegawai
              input.dataset.field = f.key;
              div.appendChild(input);

              card.appendChild(div);
            });

            // Tombol simpan
            if (isAdmin) {
              const btnSimpan = document.createElement('button');
              btnSimpan.className = 'btn-simpan';
              btnSimpan.textContent = 'Simpan';
              btnSimpan.onclick = () => {
                // Ambil data dari input
                const inputs = card.querySelectorAll('input');
                const updateData = {};
                inputs.forEach(inp => {
                  const nikPegawai = inp.dataset.nik; // id dokumen
                  const field = inp.dataset.field;
                  const val = parseInt(inp.value);
                  if (!isNaN(val)) {
                    // Simpan ke object update
                    if (!updateData['cutiTerpakai']) updateData['cutiTerpakai'] = {};
                    updateData['cutiTerpakai'][field] = val;
                  }
                });
                // Update ke Firebase
                db.collection('pegawai').doc(nikPegawai).update(updateData)
                  .then(() => {
                    alert('Data berhasil disimpan.');
                    loadPegawai(); // Refresh data kartu
                  })
                  .catch(e => {
                    alert('Gagal menyimpan data!');
                    console.error(e);
                  });
              };
              card.appendChild(btnSimpan);
            }

            container.appendChild(card);
          });
        });
    }

    // ================== Inisial load ==================
    window.onload = () => {
      loadPegawai();
    };
  </script>
</body>
</html>
