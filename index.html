<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Manajemen Cuti RRI Sibolga</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<style>
  /* CSS Style */
  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Montserrat', sans-serif;
    background-color: #f0f4f8;
    color: #333;
    margin: 0;
    padding: 0;
  }

  /* Header dan tombol login/admin */
  #header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #007bff;
    padding: 15px 20px;
    color: #fff;
  }

  #logo-title {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  #logo {
    width: 60px;
  }

  #title {
    font-size: 22px;
    font-weight: 700;
  }

  #action-buttons {
    display: flex;
    gap: 10px;
  }

  .btn {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
  }

  .btn:hover {
    transform: translateY(-2px);
  }

  /* Daftar pegawai */
  h2 {
    text-align: center;
    margin: 20px 0 10px 0;
    color: #007bff;
  }

  #listPegawai {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    padding: 10px;
  }

  .pegawaiCard {
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    padding: 15px;
    width: 350px;
  }

  .pegawaiName {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
  }

  /* Form input cuti */
  .form-group {
    margin-bottom: 8px;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    font-size: 14px;
  }

  .form-group input {
    width: 80px;
    padding: 4px;
    margin-top: 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  /* Tombol simpan di kartu */
  .btn-simpan {
    margin-top: 12px;
    background-color: #28a745;
    color: #fff;
    padding: 8px 14px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s;
  }

  .btn-simpan:hover {
    background-color: #218838;
  }
</style>
</head>
<body>

<!-- Header dan tombol login/admin -->
<div id="header">
  <div id="logo-title">
    <img src="https://i.imgur.com/8R2mU4k.png" alt="Logo" id="logo" />
    <div id="title">RRI Sibolga</div>
  </div>
  <div id="action-buttons">
    <button id="loginAdminBtn" class="btn" style="background-color:#dc3545;">Login Admin</button>
    <button id="toggleModeBtn" class="btn" style="background-color:#28a745;">Mode: User</button>
  </div>
</div>

<!-- Daftar pegawai -->
<h2 style="text-align:center;">Daftar Pegawai</h2>
<div id="listPegawai"></div>

<!-- Firebase dan Script -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
  // ================== Firebase Config ==================
  const firebaseConfig = {
    apiKey: "AIzaSyBBDMhvpAboYaEUIfo0eyzjZxK6iZyQwpo",
    authDomain: "cutirri.firebaseapp.com",
    projectId: "cutirri",
    storageBucket: "cutirri.appspot.com",
    messagingSenderId: "310950239670",
    appId: "1:310950239670:web:3b58351db2c5946f8c3517",
    measurementId: "G-BENDLYTZ2Z"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let isAdmin = false;
  const PASSWORD_ADMIN = "rriadmin2025";

  // ================== Login Admin ==================
 document.getElementById("loginAdminBtn").addEventListener("click", () => {
   const password = prompt("Masukkan password admin:");
   if (password === PASSWORD_ADMIN) {
     isAdmin = true;
     document.getElementById("toggleModeBtn").textContent = "Mode: Admin";
     loadPegawai();
     alert("Anda masuk sebagai Admin");
     document.getElementById("loginAdminBtn").style.display = "none";
   } else {
     alert("Password salah!");
   }
 });

 // ================== Mode toggle ==================
 document.getElementById("toggleModeBtn").addEventListener("click", () => {
   if (!isAdmin) {
     alert("Silakan login sebagai admin terlebih dahulu.");
     return;
   }
   isAdmin = false;
   document.getElementById("toggleModeBtn").textContent = "Mode: User";
   loadPegawai();
   document.getElementById("loginAdminBtn").style.display = "inline-block";
 });

 // ================== Data Pegawai Awal ==================
 const initialEmployees = [
   "Yanni Peter Latuheru, S.Sos",
   "Ichwansyah Pohan, S.E",
   "Rosmawan Hutabarat, S.E",
   "Viktor Hamonangan Hutabarat",
   "Khairil",
   "Vivi Tri Doharny Daulay",
   "Diskatarisa Hutabarat",
   "Novita Sari Putri S.E",
   "Silverius Hamonangan P. Purba, S.Sos",
   "Frans Martuani Sinaga, S.M",
   "Ade Wulan Septyaningsih, S.IP",
   "Nurhamni Ichwarti, S.Sos",
   "Citra Priadi Pasaribu, S.IP",
   "Azis Fahri Tanjung, S.Kom",
   "Annisa Lestari Nasution, A.Md.Ak",
   "Putri Andriani, A.Md.Ak",
   "Mahana Aprilia, A.Md.Ak",
   "Idola Pratiwi Sinaga, A.md.Pjk",
   "Ray Wiranta, A.Md.A.B",
   "Indah Farima Putri, A.Md",
   "Hans Pierre Sitohang, A.Md",
   "Sopiah Hasibuan, A.Md",
   "Aziziah khurfatul Janah, A.Md.Ds",
   "Astrid khairani Sinaga, A.Md",
   "Intan Friskila hondro, A.Md",
   "Anna Theresia Simatupang, S.Sos",
   "Desi Suriani Pasaribu, S.E",
   "Rindu Fatmawaty, S.H",
   "Gerhanawati, S.E",
   "Ismail Marzuki, S.Sos",
   "Ronny Ferdian, S.E",
   "Safran Nuh Nasution, S.T",
   "M.Khalis Pasaribu, S.Ikom",
   "Eko Putra Hutabarat, A.Md",
   "Ahmad Ridho Siregar, A.Md.T",
   "Ahlis Jami'ah Damanik, A.Md.Kom",
   "Deliana Nasution",
   "Widya Sartika Nasution",
   "Paulus Hadi",
   "Ahmad Ferdian",
   "Anhar Rianto Pasaribu",
   "Deny Siahaan",
   "Abdul Jalil",
   "Dedi Hariadi",
   "Edi Suheri",
   "Muafdan Jega",
   "Joyful Rom Sihotang",
   "James Fransiskus",
   "Jonni Sihombing",
   "Martha Monica Putri Siahaan, S.T",
   "Erni Sasmita, S.E",
   "Wilson Pangihutan Siregar",
   "Welly Boy Simatupang, S.E",
   "Eva Meylina Siahaan",
   "Flora Susanti Lumbantobing",
   "Ester Tampubolon",
   "Bernard Adi Saputra Saragih",
   "Felix Simatupang",
   "Mukhtadinul Ikhsan",
   "Halasson Siahaan",
   "Mahar Yusuf Sinaga",
   "Irfan Sihotang",
   "Rizky Ramadhan Piliang",
   "Andrian Mendrofa"
 ];

  // ================== Fungsi load data pegawai ==================
 function loadPegawai() {
   const container = document.getElementById("listPegawai");
   container.innerHTML = "";

   // Jika data awal belum ada di Firebase, insert data ini
   // Cek dulu apakah koleksi kosong
   db.collection("pegawai").limit(1).get().then(snap => {
     if (snap.empty) {
       // Insert data pegawai awal
       initialEmployees.forEach((nama, index) => {
         db.collection("pegawai").doc(`pegawai_${index + 1}`).set({
           nama: nama,
           nik: `NIK_${index + 1}`,
           cutiTerpakai: {
             tahunan: 0,
             besar: 0,
             sakit: 0,
             melahirkan: 0,
             penting: 0,
             luar_negara: 0
           }
         });
       });
     }
     // Setelah cek/simpan data awal, muat data
     db.collection("pegawai")
       .get()
       .then((querySnapshot) => {
         querySnapshot.forEach((doc) => {
           const data = doc.data();
           const nama = data.nama || "Tanpa Nama";
           const nik = data.nik || "NIK tidak diketahui";
           const cuti = data.cutiTerpakai || {};

           // Buat kartu pegawai
           const card = document.createElement("div");
           card.className = "pegawaiCard";

           // Nama dan nik
           const namaEl = document.createElement("div");
           namaEl.className = "pegawaiName";
           namaEl.textContent = `${nama} (NIK: ${nik})`;
           card.appendChild(namaEl);

           // Jenis cuti
           const fields = [
             { label: "Cuti Tahunan", key: "tahunan" },
             { label: "Cuti Besar", key: "besar" },
             { label: "Cuti Sakit", key: "sakit" },
             { label: "Cuti Melahirkan", key: "melahirkan" },
             { label: "Cuti Karena Alasan Penting", key: "penting" },
             { label: "Cuti di Luar Negara", key: "luar_negara" }
           ];

           // Input cuti
           fields.forEach((f) => {
             const div = document.createElement("div");
             div.className = "form-group";

             const label = document.createElement("label");
             label.textContent = f.label + ": ";
             div.appendChild(label);

             const input = document.createElement("input");
             input.type = "number";
             input.min = 0;
             input.value = cuti[f.key] !== undefined ? cuti[f.key] : 0;
             input.dataset.nik = doc.id;
             input.dataset.field = f.key;
             div.appendChild(input);

             card.appendChild(div);
           });

           // Tombol simpan (hanya admin)
           if (isAdmin) {
             const btnSimpan = document.createElement("button");
             btnSimpan.className = "btn-simpan";
             btnSimpan.textContent = "Simpan";
             btnSimpan.onclick = () => {
               const inputs = card.querySelectorAll("input");
               const updateData = { cutiTerpakai: {} };
               inputs.forEach((inp) => {
                 const val = parseInt(inp.value);
                 if (!isNaN(val)) {
                   updateData.cutiTerpakai[inp.dataset.field] = val;
                 }
               });
               db.collection("pegawai").doc(doc.id)
                 .update(updateData)
                 .then(() => {
                   alert("Data berhasil disimpan");
                   loadPegawai(); // refresh
                 })
                 .catch((e) => {
                   alert("Gagal menyimpan data");
                   console.error(e);
                 });
             };
             card.appendChild(btnSimpan);
           }

           container.appendChild(card);
         });
       });
   });
 }

 // ================== Inisialisasi load data ==================
 window.onload = () => {
   loadPegawai();
 };
</script>
</body>
</html>
